{
  "predict": {
    "traces": [],
    "train": [],
    "demos": [
      {
        "augmented": true,
        "question": "Which product category had the highest total quantity sold in June 2020?",
        "db_schema": "\nYou are an expert SQL developer working with the Northwind database.\n\nDATABASE TABLES:\n1. Categories\n   - CategoryID (PRIMARY KEY)\n   - CategoryName (text)\n   - Description (text)\n\n2. Products\n   - ProductID (PRIMARY KEY)\n   - ProductName (text)\n   - CategoryID (FOREIGN KEY -> Categories)\n   - UnitPrice (REAL)\n   - UnitsInStock (INTEGER)\n   - Discontinued (BOOLEAN)\n\n3. Customers\n   - CustomerID (PRIMARY KEY)\n   - CompanyName (text)\n   - ContactName (text)\n   - City (text)\n   - Country (text)\n\n4. Orders\n   - OrderID (PRIMARY KEY)\n   - CustomerID (FOREIGN KEY -> Customers)\n   - OrderDate (DATE)\n   - ShippedDate (DATE)\n\n5. Order Details (note: table name has a space)\n   - OrderID (FOREIGN KEY -> Orders)\n   - ProductID (FOREIGN KEY -> Products)\n   - UnitPrice (REAL)\n   - Quantity (INTEGER)\n   - Discount (REAL, 0-1 scale, e.g., 0.05 = 5%)\n\nKEY FACTS ABOUT THE DATA:\n- All dates are in SQLite DATE format (YYYY-MM-DD)\n- Date range: 2012-2023\n- Discount values are stored as decimals (0.0-1.0), NOT percentages\n- To convert discount to percentage, multiply by 100\n- Date filtering: use strftime('%Y-%m', OrderDate) or strftime('%Y', OrderDate)\n- Revenue calculation: SUM(UnitPrice * Quantity * (1 - COALESCE(Discount, 0)))\n- Gross Margin calculation: Revenue * (1 - CostOfGoods%) where CostOfGoods is typically 70% of UnitPrice\n\nIMPORTANT SQLite SYNTAX:\n- Use backticks or square brackets for table/column names with spaces: [Order Details]\n- Use COALESCE() for NULL handling\n- Use strftime() for date operations, NOT DAY(), MONTH(), YEAR()\n- Use CAST() to convert types: CAST(value AS FLOAT)\n- Use ROUND(value, decimals) for rounding\n- Use COUNT(DISTINCT column) for unique counts\n\nSAMPLE QUERIES:\n1. Orders in a specific month:\n   WHERE strftime('%Y-%m', OrderDate) = '2020-06'\n\n2. Orders in a quarter:\n   WHERE strftime('%Y-%m', OrderDate) BETWEEN '2020-01' AND '2020-03'\n\n3. Discount percentage across orders:\n   ROUND(AVG(COALESCE(Discount, 0)) * 100, 2) AS avg_discount_pct\n\n4. Revenue with margin:\n   SUM(OD.UnitPrice * OD.Quantity * (1 - COALESCE(OD.Discount, 0)))\n",
        "context": "Data range: 2012-2023. Use strftime for dates, COALESCE for nulls, CAST for floats.",
        "reasoning": "To find out which product category had the highest total quantity sold in June 2020, we need to join all relevant tables (Orders, [Order Details], Products), filter orders made only in June 2020 and then sum up quantities for each category. The SQL query should group results by CategoryID or CategoryName after joining with the Categories table so that it's clear which categories are being referred to.",
        "sql": "SELECT Cat.CategoryName, SUM(OD.Quantity) AS total_quantity_sold\nFROM Orders O \nINNER JOIN [Order Details] OD ON O.OrderID = OD.OrderID\nINNER JOIN Products P ON OD.ProductID = P.ProductID\nINNER JOIN Categories Cat ON P.CategoryID = Cat.CategoryID\nWHERE strftime('%Y-%m', OrderDate) = '2020-06'\nGROUP BY Cat.CategoryName\nORDER BY total_quantity_sold DESC\nLIMIT 1;"
      },
      {
        "augmented": true,
        "question": "What was the Average Order Value during December 2020?",
        "db_schema": "\nYou are an expert SQL developer working with the Northwind database.\n\nDATABASE TABLES:\n1. Categories\n   - CategoryID (PRIMARY KEY)\n   - CategoryName (text)\n   - Description (text)\n\n2. Products\n   - ProductID (PRIMARY KEY)\n   - ProductName (text)\n   - CategoryID (FOREIGN KEY -> Categories)\n   - UnitPrice (REAL)\n   - UnitsInStock (INTEGER)\n   - Discontinued (BOOLEAN)\n\n3. Customers\n   - CustomerID (PRIMARY KEY)\n   - CompanyName (text)\n   - ContactName (text)\n   - City (text)\n   - Country (text)\n\n4. Orders\n   - OrderID (PRIMARY KEY)\n   - CustomerID (FOREIGN KEY -> Customers)\n   - OrderDate (DATE)\n   - ShippedDate (DATE)\n\n5. Order Details (note: table name has a space)\n   - OrderID (FOREIGN KEY -> Orders)\n   - ProductID (FOREIGN KEY -> Products)\n   - UnitPrice (REAL)\n   - Quantity (INTEGER)\n   - Discount (REAL, 0-1 scale, e.g., 0.05 = 5%)\n\nKEY FACTS ABOUT THE DATA:\n- All dates are in SQLite DATE format (YYYY-MM-DD)\n- Date range: 2012-2023\n- Discount values are stored as decimals (0.0-1.0), NOT percentages\n- To convert discount to percentage, multiply by 100\n- Date filtering: use strftime('%Y-%m', OrderDate) or strftime('%Y', OrderDate)\n- Revenue calculation: SUM(UnitPrice * Quantity * (1 - COALESCE(Discount, 0)))\n- Gross Margin calculation: Revenue * (1 - CostOfGoods%) where CostOfGoods is typically 70% of UnitPrice\n\nIMPORTANT SQLite SYNTAX:\n- Use backticks or square brackets for table/column names with spaces: [Order Details]\n- Use COALESCE() for NULL handling\n- Use strftime() for date operations, NOT DAY(), MONTH(), YEAR()\n- Use CAST() to convert types: CAST(value AS FLOAT)\n- Use ROUND(value, decimals) for rounding\n- Use COUNT(DISTINCT column) for unique counts\n\nSAMPLE QUERIES:\n1. Orders in a specific month:\n   WHERE strftime('%Y-%m', OrderDate) = '2020-06'\n\n2. Orders in a quarter:\n   WHERE strftime('%Y-%m', OrderDate) BETWEEN '2020-01' AND '2020-03'\n\n3. Discount percentage across orders:\n   ROUND(AVG(COALESCE(Discount, 0)) * 100, 2) AS avg_discount_pct\n\n4. Revenue with margin:\n   SUM(OD.UnitPrice * OD.Quantity * (1 - COALESCE(OD.Discount, 0)))\n",
        "context": "Data range: 2012-2023. Use strftime for dates, COALESCE for nulls, CAST for floats.",
        "reasoning": "To find the Average Order Value during December 2020, we need to calculate the total revenue generated in that month and divide it by the number of orders placed. The average order value is a common metric used to assess customer spending on each transaction as well as evaluate the company's performance.",
        "sql": "SELECT ROUND(SUM(OD.UnitPrice * OD.Quantity) / COUNT(*), 2) AS avg_order_value\nFROM Orders O\nINNER JOIN [Order Details] OD ON O.OrderID = OD.OrderID\nWHERE strftime('%Y-%m', OrderDate) = '2020-12'"
      },
      {
        "augmented": true,
        "question": "Top 3 products by total revenue all-time. Revenue = SUM(UnitPrice*Quantity*(1-Discount)). Return list[{product:str, revenue:float}].",
        "db_schema": "\nYou are an expert SQL developer working with the Northwind database.\n\nDATABASE TABLES:\n1. Categories\n   - CategoryID (PRIMARY KEY)\n   - CategoryName (text)\n   - Description (text)\n\n2. Products\n   - ProductID (PRIMARY KEY)\n   - ProductName (text)\n   - CategoryID (FOREIGN KEY -> Categories)\n   - UnitPrice (REAL)\n   - UnitsInStock (INTEGER)\n   - Discontinued (BOOLEAN)\n\n3. Customers\n   - CustomerID (PRIMARY KEY)\n   - CompanyName (text)\n   - ContactName (text)\n   - City (text)\n   - Country (text)\n\n4. Orders\n   - OrderID (PRIMARY KEY)\n   - CustomerID (FOREIGN KEY -> Customers)\n   - OrderDate (DATE)\n   - ShippedDate (DATE)\n\n5. Order Details (note: table name has a space)\n   - OrderID (FOREIGN KEY -> Orders)\n   - ProductID (FOREIGN KEY -> Products)\n   - UnitPrice (REAL)\n   - Quantity (INTEGER)\n   - Discount (REAL, 0-1 scale, e.g., 0.05 = 5%)\n\nKEY FACTS ABOUT THE DATA:\n- All dates are in SQLite DATE format (YYYY-MM-DD)\n- Date range: 2012-2023\n- Discount values are stored as decimals (0.0-1.0), NOT percentages\n- To convert discount to percentage, multiply by 100\n- Date filtering: use strftime('%Y-%m', OrderDate) or strftime('%Y', OrderDate)\n- Revenue calculation: SUM(UnitPrice * Quantity * (1 - COALESCE(Discount, 0)))\n- Gross Margin calculation: Revenue * (1 - CostOfGoods%) where CostOfGoods is typically 70% of UnitPrice\n\nIMPORTANT SQLite SYNTAX:\n- Use backticks or square brackets for table/column names with spaces: [Order Details]\n- Use COALESCE() for NULL handling\n- Use strftime() for date operations, NOT DAY(), MONTH(), YEAR()\n- Use CAST() to convert types: CAST(value AS FLOAT)\n- Use ROUND(value, decimals) for rounding\n- Use COUNT(DISTINCT column) for unique counts\n\nSAMPLE QUERIES:\n1. Orders in a specific month:\n   WHERE strftime('%Y-%m', OrderDate) = '2020-06'\n\n2. Orders in a quarter:\n   WHERE strftime('%Y-%m', OrderDate) BETWEEN '2020-01' AND '2020-03'\n\n3. Discount percentage across orders:\n   ROUND(AVG(COALESCE(Discount, 0)) * 100, 2) AS avg_discount_pct\n\n4. Revenue with margin:\n   SUM(OD.UnitPrice * OD.Quantity * (1 - COALESCE(OD.Discount, 0)))\n",
        "context": "Data range: 2012-2023. Use strftime for dates, COALESCE for nulls, CAST for floats.",
        "reasoning": "To find the top 3 products by total revenue all-time, we need to calculate the total revenue generated by each product across all orders. This involves joining the Orders table with the [Order Details] (ProductID) and summing up the revenues for each ProductID while considering discounts where applicable. We then order the results in descending order of this calculated revenue, limiting our output to just the top 3 products.",
        "sql": "SELECT P.ProductName, ROUND(SUM(OD.UnitPrice * OD.Quantity * (1 - COALESCE(OD.Discount, 0))) AS TotalRevenue\nFROM Products P\nINNER JOIN [Order Details] OD ON P.ProductID = OD.ProductID\nGROUP BY P.ProductName\nORDER BY TotalRevenue DESC\nLIMIT 3"
      },
      {
        "question": "Who was the top customer by gross margin in 2020? Assume CostOfGoods = 70% of UnitPrice. Return {customer:str, margin:float}.",
        "db_schema": "\nYou are an expert SQL developer working with the Northwind database.\n\nDATABASE TABLES:\n1. Categories\n   - CategoryID (PRIMARY KEY)\n   - CategoryName (text)\n   - Description (text)\n\n2. Products\n   - ProductID (PRIMARY KEY)\n   - ProductName (text)\n   - CategoryID (FOREIGN KEY -> Categories)\n   - UnitPrice (REAL)\n   - UnitsInStock (INTEGER)\n   - Discontinued (BOOLEAN)\n\n3. Customers\n   - CustomerID (PRIMARY KEY)\n   - CompanyName (text)\n   - ContactName (text)\n   - City (text)\n   - Country (text)\n\n4. Orders\n   - OrderID (PRIMARY KEY)\n   - CustomerID (FOREIGN KEY -> Customers)\n   - OrderDate (DATE)\n   - ShippedDate (DATE)\n\n5. Order Details (note: table name has a space)\n   - OrderID (FOREIGN KEY -> Orders)\n   - ProductID (FOREIGN KEY -> Products)\n   - UnitPrice (REAL)\n   - Quantity (INTEGER)\n   - Discount (REAL, 0-1 scale, e.g., 0.05 = 5%)\n\nKEY FACTS ABOUT THE DATA:\n- All dates are in SQLite DATE format (YYYY-MM-DD)\n- Date range: 2012-2023\n- Discount values are stored as decimals (0.0-1.0), NOT percentages\n- To convert discount to percentage, multiply by 100\n- Date filtering: use strftime('%Y-%m', OrderDate) or strftime('%Y', OrderDate)\n- Revenue calculation: SUM(UnitPrice * Quantity * (1 - COALESCE(Discount, 0)))\n- Gross Margin calculation: Revenue * (1 - CostOfGoods%) where CostOfGoods is typically 70% of UnitPrice\n\nIMPORTANT SQLite SYNTAX:\n- Use backticks or square brackets for table/column names with spaces: [Order Details]\n- Use COALESCE() for NULL handling\n- Use strftime() for date operations, NOT DAY(), MONTH(), YEAR()\n- Use CAST() to convert types: CAST(value AS FLOAT)\n- Use ROUND(value, decimals) for rounding\n- Use COUNT(DISTINCT column) for unique counts\n\nSAMPLE QUERIES:\n1. Orders in a specific month:\n   WHERE strftime('%Y-%m', OrderDate) = '2020-06'\n\n2. Orders in a quarter:\n   WHERE strftime('%Y-%m', OrderDate) BETWEEN '2020-01' AND '2020-03'\n\n3. Discount percentage across orders:\n   ROUND(AVG(COALESCE(Discount, 0)) * 100, 2) AS avg_discount_pct\n\n4. Revenue with margin:\n   SUM(OD.UnitPrice * OD.Quantity * (1 - COALESCE(OD.Discount, 0)))\n",
        "context": "Data range: 2012-2023. Use strftime for dates, COALESCE for nulls, CAST for floats.",
        "sql": "SELECT C.CompanyName AS customer, ROUND(SUM((OD.UnitPrice * 0.3) * OD.Quantity * (1 - COALESCE(OD.Discount, 0))), 2) AS margin\nFROM Orders O\nINNER JOIN [Order Details] OD ON O.OrderID = OD.OrderID\nINNER JOIN Customers C ON O.CustomerID = C.CustomerID\nWHERE strftime('%Y', O.OrderDate) = '2020'\nGROUP BY O.CustomerID, C.CompanyName\nORDER BY margin DESC\nLIMIT 1"
      },
      {
        "question": "Total revenue from the Beverages category during June 2020? Return a float rounded to 2 decimals.",
        "db_schema": "\nYou are an expert SQL developer working with the Northwind database.\n\nDATABASE TABLES:\n1. Categories\n   - CategoryID (PRIMARY KEY)\n   - CategoryName (text)\n   - Description (text)\n\n2. Products\n   - ProductID (PRIMARY KEY)\n   - ProductName (text)\n   - CategoryID (FOREIGN KEY -> Categories)\n   - UnitPrice (REAL)\n   - UnitsInStock (INTEGER)\n   - Discontinued (BOOLEAN)\n\n3. Customers\n   - CustomerID (PRIMARY KEY)\n   - CompanyName (text)\n   - ContactName (text)\n   - City (text)\n   - Country (text)\n\n4. Orders\n   - OrderID (PRIMARY KEY)\n   - CustomerID (FOREIGN KEY -> Customers)\n   - OrderDate (DATE)\n   - ShippedDate (DATE)\n\n5. Order Details (note: table name has a space)\n   - OrderID (FOREIGN KEY -> Orders)\n   - ProductID (FOREIGN KEY -> Products)\n   - UnitPrice (REAL)\n   - Quantity (INTEGER)\n   - Discount (REAL, 0-1 scale, e.g., 0.05 = 5%)\n\nKEY FACTS ABOUT THE DATA:\n- All dates are in SQLite DATE format (YYYY-MM-DD)\n- Date range: 2012-2023\n- Discount values are stored as decimals (0.0-1.0), NOT percentages\n- To convert discount to percentage, multiply by 100\n- Date filtering: use strftime('%Y-%m', OrderDate) or strftime('%Y', OrderDate)\n- Revenue calculation: SUM(UnitPrice * Quantity * (1 - COALESCE(Discount, 0)))\n- Gross Margin calculation: Revenue * (1 - CostOfGoods%) where CostOfGoods is typically 70% of UnitPrice\n\nIMPORTANT SQLite SYNTAX:\n- Use backticks or square brackets for table/column names with spaces: [Order Details]\n- Use COALESCE() for NULL handling\n- Use strftime() for date operations, NOT DAY(), MONTH(), YEAR()\n- Use CAST() to convert types: CAST(value AS FLOAT)\n- Use ROUND(value, decimals) for rounding\n- Use COUNT(DISTINCT column) for unique counts\n\nSAMPLE QUERIES:\n1. Orders in a specific month:\n   WHERE strftime('%Y-%m', OrderDate) = '2020-06'\n\n2. Orders in a quarter:\n   WHERE strftime('%Y-%m', OrderDate) BETWEEN '2020-01' AND '2020-03'\n\n3. Discount percentage across orders:\n   ROUND(AVG(COALESCE(Discount, 0)) * 100, 2) AS avg_discount_pct\n\n4. Revenue with margin:\n   SUM(OD.UnitPrice * OD.Quantity * (1 - COALESCE(OD.Discount, 0)))\n",
        "context": "Data range: 2012-2023. Use strftime for dates, COALESCE for nulls, CAST for floats.",
        "sql": "SELECT ROUND(SUM(OD.UnitPrice * OD.Quantity * (1 - COALESCE(OD.Discount, 0))), 2) AS TotalRevenue\nFROM Orders O\nINNER JOIN [Order Details] OD ON O.OrderID = OD.OrderID\nINNER JOIN Products P ON OD.ProductID = P.ProductID\nINNER JOIN Categories C ON P.CategoryID = C.CategoryID\nWHERE C.CategoryName = 'Beverages' AND strftime('%Y-%m', O.OrderDate) = '2020-06'"
      }
    ],
    "signature": {
      "instructions": "Generate SQL query from natural language and database schema.",
      "fields": [
        {
          "prefix": "Question:",
          "description": "Natural language question"
        },
        {
          "prefix": "Db Schema:",
          "description": "Database schema with table and column definitions"
        },
        {
          "prefix": "Context:",
          "description": "Relevant context. CRITICAL: Use SQLite date functions strftime('%Y-%m', OrderDate) NOT MONTH/YEAR which don't exist. Data is from 2012-2023."
        },
        {
          "prefix": "Reasoning: Let's think step by step in order to",
          "description": "${reasoning}"
        },
        {
          "prefix": "Sql:",
          "description": "Valid SQLite query (no markdown). Use [Order Details] brackets, strftime for dates, COALESCE for nulls, CAST for floats, LIMIT not TOP. Data 2012-2023."
        }
      ]
    },
    "lm": null
  },
  "metadata": {
    "dependency_versions": {
      "python": "3.13",
      "dspy": "3.0.4",
      "cloudpickle": "3.1"
    }
  }
}
